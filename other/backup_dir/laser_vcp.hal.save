loadusr -W pyvcp -c pyvcp laser_vcp.xml

loadrt hal_parport cfg="0xb400"

addf parport.0.write servo-thread -1

# invoke this with halrun

loadrt or2 count=4
addf or2.0 servo-thread
addf or2.1 servo-thread

loadrt oneshot count=1
addf oneshot.0 servo-thread 

# ------------- 
# bounce estop
net bit1 pyvcp.estop_reset_button => pyvcp.led-sample1 parport.0.pin-02-out
# ------------- 
# laser power supply
net bit2 pyvcp.chbutton-sample2 => pyvcp.led-sample2 parport.0.pin-03-out
# ------------- 
# motor power supply
net bit3 pyvcp.chbutton-sample3 => pyvcp.led-sample3 parport.0.pin-04-out
# ------------- 
# chiller
net bit4 pyvcp.chbutton-sample4 => pyvcp.led-sample4 parport.0.pin-05-out

# ------------- 
# create ventilation, link to motion.digital, and or2-ed with a checkbutton
newsig ventilation bit
linksp ventilation <= motion.digital-out-00 

newsig chbutton5 bit
linksp chbutton5 pyvcp.chbutton-sample5

linksp ventilation or2.0.in0
linksp chbutton5 or2.0.in1
net bit5 parport.0.pin-06-out or2.0.out pyvcp.led-sample5

# ------------- 
# create gas line, link to motion.digital, and or2-ed with a checkbutton
newsig gasline bit
linksp gasline <= motion.digital-out-01

newsig chbutton6 bit
linksp chbutton6 pyvcp.chbutton-sample6

linksp gasline or2.1.in0
linksp chbutton6 or2.1.in1
net bit6 parport.0.pin-07-out or2.1.out pyvcp.led-sample6

# ------------- 
# lighting
net bit7 pyvcp.chbutton-sample7 => pyvcp.led-sample7 parport.0.pin-08-out 

# never got this stuff to work. 
# hook a pyvcp slider (floating point value) to oneshot.0.width, 
#  and a pyvcp momentary button to oneshot.N.in
#  and oneshot.0.out to your laser enable

# net float1 pyvcp.pulse_duration-f => oneshot.0.width 
# net bit8 pyvcp.pulse_button => oneshot.0.in

#  oneshot.0.out must get connected to laser enable
# I thought it should be this...
# net bit9 oneshot.0.out => pyvcp.led-pulse halui.mist.on
# but that does not pulse the laser.

# net bit9 oneshot.0.out => pyvcp.led-pulse 


############################################################

# load the m5i20 driver
loadrt hal_m5i20

# update digital inputs
addf m5i20.0.digital-in-read servo-thread 1

# update digital outputs
addf m5i20.0.digital-out-write servo-thread 1

# misc update ? required to update onboard LEDs (at least...)
addf m5i20.0.misc-update servo-thread 1

# update encoder counters
addf m5i20.0.encoder-read servo-thread 1

# update DACs and DAC-enable
addf m5i20.0.dac-write servo-thread 1

# IO
# Link digital inputs to LEDs
net pyvcp.in26     m5i20.0.in-26-not
net pyvcp.in27     m5i20.0.in-27
net pyvcp.in28     m5i20.0.in-28
net pyvcp.in29     m5i20.0.in-29
net pyvcp.in30     m5i20.0.in-30
net pyvcp.in31     m5i20.0.in-31-not

# link digital outputs to buttons

setp m5i20.0.out-15-invert FALSE

net pyvcp.out14 m5i20.0.out-14
net pyvcp.out13 m5i20.0.out-13
net pyvcp.out12 m5i20.0.out-12
net pyvcp.out11 m5i20.0.out-11
net pyvcp.out10 m5i20.0.out-10
net pyvcp.out9  m5i20.0.out-09
net pyvcp.out8  m5i20.0.out-08

# ------------- 
# the output of the motion.out2 and pyvcp button are
# OR-ed link to the M5i20 card.

net pyvcp.out15 m5i20.0.out-15
